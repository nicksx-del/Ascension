<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes dos Gastos - Ascension</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Page specific overrides */
    </style>
</head>

<body>
    <div class="container">

        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <button class="back-button" onclick="window.location.href='home.html'">
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                    </svg>
                </button>
                <h1 class="page-title">Detalhes dos Gastos</h1>
            </div>
            <button class="calendar-button">
                <svg fill="currentColor" viewBox="0 0 24 24">
                    <path
                        d="M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z" />
                </svg>
            </button>
        </div>

        <!-- Summary Card -->
        <div class="summary-card">
            <div class="summary-header">
                <span class="summary-label">Total em Outubro</span>
                <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </div>
            <div class="summary-amount-row">
                <span class="summary-amount" id="totalExpenses">R$ 0,00</span>
                <div class="percentage-badge" id="percentageBadge" style="display: none;">
                    üìà +12%
                </div>
            </div>

            <!-- Donut Chart -->
            <div class="donut-chart-container">
                <div class="donut-chart">
                    <svg viewBox="0 0 36 36" class="circular-chart">
                        <!-- Background Circle -->
                        <path class="circle-bg" d="M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <!-- Orange Segment (40%) -->
                        <path class="circle orange" stroke-dasharray="40, 100" d="M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <!-- Green Segment (35% after 40%) -->
                        <path class="circle green" stroke-dasharray="35, 100" stroke-dashoffset="-40" d="M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <!-- Yellow Segment (25% after 75%) -->
                        <path class="circle yellow" stroke-dasharray="25, 100" stroke-dashoffset="-75" d="M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831" />
                    </svg>
                    <div class="chart-center-text">
                        <span class="chart-label">Total Acumulado</span>
                        <span class="chart-amount" id="chartTotalDisplay">R$ 0,00</span>
                        <span class="chart-trend">‚Üë +12% este m√™s</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <button class="filter-chip active">Tudo</button>
            <button class="filter-chip">Alimenta√ß√£o</button>
            <button class="filter-chip">Transporte</button>
            <button class="filter-chip">Compras</button>
        </div>

        <!-- Transactions Header -->
        <div class="transactions-header">
            <h2 class="transactions-title">Transa√ß√µes</h2>
            <a href="#" class="view-all">Ver extrato</a>
        </div>

        <!-- Transaction List -->
        <div class="transaction-list" id="transactionList">
            <div style="text-align: center; padding: 40px 20px; color: #9e9ea3;">
                <p>Nenhuma transa√ß√£o registrada ainda.</p>
                <p style="font-size: 13px; margin-top: 8px;">Adicione sua primeira transa√ß√£o clicando no bot√£o +</p>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="home.html" class="nav-item">
                <svg fill="currentColor" viewBox="0 0 24 24">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                </svg>
                <span>In√≠cio</span>
            </a>
            <a href="#" class="nav-item active">
                <svg fill="currentColor" viewBox="0 0 24 24">
                    <path
                        d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z" />
                </svg>
                <span>Gastos</span>
            </a>
            <a href="#" class="nav-item">
                <svg fill="currentColor" viewBox="0 0 24 24">
                    <path
                        d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z" />
                </svg>
                <span>Msg</span>
                <span class="badge"></span>
            </a>
            <a href="perfil.html" class="nav-item">
                <svg fill="currentColor" viewBox="0 0 24 24">
                    <path
                        d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                </svg>
                <span>Perfil</span>
            </a>
        </nav>
    </div>

    <script>
        // Carregar transa√ß√µes do localStorage
        const transactions = JSON.parse(localStorage.getItem('ascension_transactions') || '[]');

        if (transactions.length > 0) {
            // Calcular total
            let total = 0;
            transactions.forEach(t => {
                const value = parseFloat(t.amount.replace(/[^\d,]/g, '').replace(',', '.'));
                if (!isNaN(value)) {
                    total += value;
                }
            });

            // Atualizar total
            const formattedTotal = `R$ ${total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            const totalEl = document.getElementById('totalExpenses');
            if (totalEl) totalEl.textContent = formattedTotal;

            const chartTotalEl = document.getElementById('chartTotalDisplay');
            if (chartTotalEl) chartTotalEl.textContent = formattedTotal;

            // Mostrar badge de percentual se houver dados
            if (total > 0) {
                document.getElementById('percentageBadge').style.display = 'flex';
            }

            // Renderizar transa√ß√µes
            const transactionList = document.getElementById('transactionList');
            transactionList.innerHTML = '';

            transactions.reverse().forEach((transaction, index) => {
                const categoryIcons = {
                    'alimentacao': { bg: '#FFE8DB', icon: 'üõí', color: '#FF6B00' },
                    'transporte': { bg: '#E3F2FD', icon: 'üöó', color: '#2196F3' },
                    'saude': { bg: '#E8F5E9', icon: '‚ù§Ô∏è', color: '#4CAF50' },
                    'lazer': { bg: '#F3E5F5', icon: 'üéÆ', color: '#9C27B0' },
                    'educacao': { bg: '#FFF3E0', icon: 'üìö', color: '#FF9800' },
                    'outros': { bg: '#f0f0f2', icon: 'üì¶', color: '#5e5e62' }
                };

                const category = categoryIcons[transaction.category] || categoryIcons['outros'];
                const originalIndex = transactions.length - 1 - index; // Get original index

                const item = document.createElement('div');
                item.className = 'transaction-item';
                item.innerHTML = `
                    <div class="transaction-icon" style="background: ${category.bg}; font-size: 24px;">
                        ${category.icon}
                    </div>
                    <div class="transaction-info">
                        <div class="transaction-name">${transaction.itemName}</div>
                        <div class="transaction-date">${formatDate(transaction.date)}</div>
                    </div>
                    <div class="transaction-actions">
                        <button class="action-btn edit" onclick="editTransaction(${originalIndex})">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>
                        <button class="action-btn delete" onclick="deleteTransaction(${originalIndex})">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 0 0 1 2-2h4a2 0 0 1 2 2v2"></path>
                            </svg>
                        </button>
                    </div>
                `;
                transactionList.appendChild(item);
            });
        }

        function editTransaction(index) {
            const transactions = JSON.parse(localStorage.getItem('ascension_transactions') || '[]');
            const transaction = transactions[index];

            // Salvar dados da transa√ß√£o para edi√ß√£o
            localStorage.setItem('ascension_edit_transaction', JSON.stringify({
                index: index,
                data: transaction
            }));

            // Redirecionar para p√°gina de edi√ß√£o
            window.location.href = 'novo-registro.html';
        }

        function deleteTransaction(index) {
            if (confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
                const transactions = JSON.parse(localStorage.getItem('ascension_transactions') || '[]');
                transactions.splice(index, 1);
                localStorage.setItem('ascension_transactions', JSON.stringify(transactions));

                // Recarregar p√°gina
                window.location.reload();
            }
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            if (date.toDateString() === today.toDateString()) {
                return `Hoje, ${date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}`;
            } else if (date.toDateString() === yesterday.toDateString()) {
                return `Ontem, ${date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}`;
            } else {
                return date.toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' });
            }
        }
    </script>
</body>

</html>